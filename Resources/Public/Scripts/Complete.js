(()=>{function k(t){t.directive("prettyembedconsent",(e,{value:i})=>{if(i==="accept"){Q({element:e,Alpine:t});return}B({element:e,Alpine:t})})}function B({element:t,Alpine:e}){e.bind(t,{"x-show"(){return this.gdpr=="isOpen"},"x-transition.opacity"(){}})}function Q({element:t,Alpine:e}){e.bind(t,{"@click"(i){i.preventDefault(),this.acceptGdpr()}})}var I=!1,C=!1;function x(t,e){let i=document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("defer",!0),i.setAttribute("src",t),typeof e=="function"&&i.addEventListener("load",e),document.head.appendChild(i)}function D(t){let e=()=>{P(()=>window.Vimeo,t)};if(C){e();return}C=!0,x("https://player.vimeo.com/api/player.js",e)}function L(t){let e=()=>{P(()=>window.YT?.loaded,t)};if(I){e();return}I=!0,x("https://www.youtube.com/iframe_api",e)}function X(t,e){let i=window.requestAnimationFrame,o=Date.now(),s=!1,n=()=>{Date.now()-o<e?s||i(n):t()};return i(n),{clear:()=>s=!0}}function P(t,e,i=100){if(!(typeof t!="function"&&typeof e!="function"||i<=0)){if(t()){e();return}i--,X(()=>P(t,e,i),100)}}function y(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement}var Z="prettyembed",tt="/_Resources/Static/Packages/Jonnitto.PrettyEmbedPresentation/Scripts/Hls.js?v=1.5.9";function H(t){t.directive("prettyembedmedia",(e,{value:i,modifiers:o,expression:s},{evaluate:n})=>{if(i==="media"){it({element:e,Alpine:t,src:s});return}let r=o.includes("streaming"),a=o.includes("lightbox")?"lightbox":"inline",d={streaming:r,style:a,...n(s||"{}")};et({element:e,Alpine:t,options:d})})}function et({element:t,Alpine:e,options:i}){let{style:o,streaming:s}=i,n={type:null,playing:!1,url:null,id:null,autoplay:!1,loaded:!1,lightbox:o==="lightbox"?!1:null,__media:null},r=s?!ot():null;e.bind(t,{"x-data"(){return{...n,play(){if(this.lightbox!==null&&(this.lightbox=!0),!!this.__media?.paused){if(!this.loaded&&s){if(r){if(this.lightbox){setTimeout(()=>{F(this.__media,this.url)},500);return}F(this.__media,this.url);return}this.__media.src=this.url}if(this.lightbox){setTimeout(()=>{this.__media?.play()},500);return}this.__media?.play()}},pause(a=!1){typeof a=="boolean"&&a&&(this.autoplay||this.__media?.muted)||this.__media?.paused||this.__media?.pause()},reset(){this.autoplay||(this.pause(),this.__media?.currentTime&&(this.__media.currentTime=0),this.loaded=!1)},toogle(){this.toggle()},toggle(){if(this.__media.paused){this.play();return}this.pause()},dispatchEvent(a){let d=this.__media.currentTime;d===this.__media.duration&&(a="finished",!this.__media.loop&&!this.lightbox&&!y()&&this.reset()),this.$dispatch(Z,{detail:{event:a,currentTime:d,type:this.type,style:o,autoplay:this.autoplay,url:this.url,id:this.id}})},init(){o==="lightbox"&&this.$watch("lightbox",(a,d)=>{!a&&a!==d&&this.pause()})}}},"@prettyembedPauseInternal.window"({detail:a}){a!=this.$root&&this.pause(!0)}})}function it({element:t,Alpine:e,src:i}){let s=t.tagName.toLowerCase()==="video"?"Video":"Audio";e.bind(t,{"x-init"(){this.__media=t,this.url=i||t.currentSrc,this.id=this.url.split("/").pop(),this.autoplay=t.autoplay,this.type=s,this.autoplay&&(this.playing=!0,this.loaded=!0)},"@play"(){this.loaded||(this.loaded=!0),this.playing=!0,!this.autoplay&&!this.muted&&(this.$dispatch("prettyembedPauseInternal",this.$root),this.dispatchEvent("play"))},"@pause"(){this.playing=!1,this.autoplay=!1,this.muted||this.dispatchEvent("pause")}})}function ot(){return!!document.createElement("video").canPlayType("application/vnd.apple.mpegurl")}function F(t,e){if(typeof window.Hls<"u"){G(t,e);return}x(tt,()=>{setTimeout(()=>G(t,e),10)})}function G(t,e){let i=window.Hls;if(!i||!i.isSupported())return;let o=new i;o.loadSource(e),o.attachMedia(t),o.on(i.Events.MEDIA_ATTACHED,()=>t.play())}function N(t){t.magic("prettyembedPause",()=>M),t.magic("prettyembedReset",()=>R),t.magic("prettyembedPlay",()=>O)}window.addEventListener("prettyembedReset",({detail:t})=>R(t));window.addEventListener("prettyembedPause",({detail:t})=>M(t));window.addEventListener("prettyembedPlay",({detail:t})=>O(t));function R(t){return S(t).forEach(e=>{let i=window.Alpine.$data(e);typeof i.reset=="function"&&i.reset()})}function M(t){return S(t).forEach(e=>{let i=window.Alpine.$data(e);typeof i.pause=="function"&&i.pause(!0)})}function O(t){return S(t).every(e=>{let i=window.Alpine.$data(e);return typeof i.play=="function"?(i.play(),!1):!0})}var E="jonnitto-prettyembed";function S(t){if(typeof t=="string"){let e=nt(t),i=[];return[...document.querySelectorAll(e)].forEach(o=>{i=[...i,...Y(o)]}),i}return Y(t)}var st=["youtube","vimeo","video","audio"];function nt(t){let e=t.toLowerCase();return st.includes(e)?`.${E}--${e}`:t}function Y(t){if(!(t instanceof Element))t=document;else if(t.classList.contains(E))return[t];return[...t.querySelectorAll(`.${E}`)]}function at(t,e){let i=Math.min(window.innerWidth,1260),o=i/t,s=(screen.width-i)/2,n=(screen.height-o)/2;window.open(e,"_blank",`noopener=yes,directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=yes,width=${i},height=${o},left=${s},top=${n}`)}function q(t){t.directive("prettyembedpopup",(e,{modifiers:i,expression:o},{evaluate:s})=>{let n=window.getComputedStyle(e).getPropertyValue("--aspect-ratio")||"16 / 9",{ratio:r}=s(`{ratio:${n}}`),a=e.href,d=i.includes("dynamic");t.bind(e,{"@click"(m){m.preventDefault();let h=(d?s(o):o)||a;at(r,h)}})})}var U="prettyembed";function W(t){t.directive("prettyembedvimeo",(e,{modifiers:i,expression:o},{evaluate:s})=>{let n=i.includes("lightbox")?"lightbox":"inline",r=i.includes("slim"),a={style:n,slim:r,...s(o||"{}")};rt({element:e,Alpine:t,options:a})})}function rt({element:t,Alpine:e,options:i}){let o="Vimeo",{style:s,slim:n,video:r,color:a,loop:d,gdpr:m,hash:h,background:v}=i,g=`https://player.vimeo.com/video/${r}`;h&&(g+=`?h=${h}`);let _={url:g,autopip:!0,autoplay:!0,pip:!0,portrait:!1,responsive:!1,title:!1,byline:!1,background:!!v,loop:!!d,autopause:!1,controls:!n};a&&(_.color=a);let u=window.localStorage,c=`jonnittoprettyembed_gdpr_${o.toLowerCase()}`,b={loaded:!1,playing:!1,lightbox:s==="lightbox"?!1:null,gdpr:m&&u.getItem(c)!=="true"?"needCheck":"isAccepted"},l=null;e.bind(t,{"x-data"(){return{...b,init(){this.lightbox!==null&&this.$watch("lightbox",(p,$)=>{!p&&p!==$&&this.pause()})},acceptGdpr(){u.setItem(c,"true"),this.$dispatch("prettyembedAcceptGdpr",o),this.load()},play(){l?.play()},pause(){l?.pause()},load(p){if(p&&p.preventDefault(),this.gdpr!="isAccepted"){this.gdpr="isOpen";return}if(this.lightbox!==null&&(this.lightbox=!0),this.loaded){this.play();return}D(()=>{let $=this.$refs?.vimeo||t;l=new window.Vimeo.Player($,_);let A=async f=>{let j=[l.getVideoTitle(),l.getVideoId(),l.getVideoUrl(),l.getCurrentTime(),l.getEnded()],w=await Promise.allSettled(j);return w[4].value&&(f="finished",!d&&!this.lightbox&&!y()&&this.reset()),{event:f,type:o,style:s,title:w[0].value,videoID:w[1].value,videoUrl:w[2].value,currentTime:w[3].value}};l.on("play",async()=>{let f=await A("play");this.$dispatch("prettyembedPauseInternal",t),this.loaded=!0,this.playing=!0,this.$dispatch(U,f)}),l.on("pause",async()=>{let f=await A("pause");this.playing=!1,this.$dispatch(U,f)})})},async reset(){l&&(await this.pause(),await l.destroy(),l=null,this.loaded=!1,this.playing=!1)}}},"@prettyembedAcceptGdpr.window"({detail:p}){p==o&&(this.gdpr="isAccepted")},"@prettyembedPauseInternal.window"({detail:p}){p!=this.$root&&this.pause()}})}var T="prettyembed";function z(t){t.directive("prettyembedyoutube",(e,{modifiers:i,expression:o},{evaluate:s})=>{let n=i.includes("lightbox")?"lightbox":"inline",a={slim:i.includes("slim"),style:n,...s(o||"{}")};lt({element:e,Alpine:t,options:a})})}function lt({element:t,Alpine:e,options:i}){let o="YouTube",{video:s,playlist:n,style:r,slim:a,loop:d,noCookie:m}=i,h={playerVars:{autoplay:1,modestbranding:1,playsinline:1,rel:0,showinfo:0,controls:a?0:1,loop:d?1:0}};m&&(h.host="https://www.youtube-nocookie.com"),s&&(h.videoId=s),n&&(n.startsWith("PL")||(n="PL"+n),h.playerVars.listType="playlist",h.playerVars.list=n);let v=window.localStorage,g=`jonnittoprettyembed_gdpr_${o.toLowerCase()}`,_={title:i.title,loaded:!1,playing:!1,lightbox:r==="lightbox"?!1:null,gdpr:i.gdpr&&v.getItem(g)!=="true"?"needCheck":"isAccepted"},u=null;e.bind(t,{"x-data"(){return{..._,init(){this.ligtbox!==null&&this.$watch("lightbox",(c,b)=>{!c&&c!==b&&this.pause()})},acceptGdpr(){v.setItem(g,"true"),this.$dispatch("prettyembedAcceptGdpr",o),this.load()},play(){u?.playVideo()},pause(){u?.pauseVideo()},load(c){if(c&&c.preventDefault(),this.gdpr!="isAccepted"){this.gdpr="isOpen";return}if(this.lightbox!==null&&(this.lightbox=!0),this.loaded){this.play();return}L(()=>{let b=this.$refs?.youtube||t,l=window.YT;u=new l.Player(b,{...h,events:{onStateChange:({data:p})=>{setTimeout(()=>{if(p===l.PlayerState.PLAYING){this.$dispatch("prettyembedPauseInternal",t),this.loaded=!0,this.playing=!0,this.$dispatch(T,V({event:"play",type:o,style:r,player:u}));return}if(p===l.PlayerState.PAUSED){this.playing=!1,this.$dispatch(T,V({event:"pause",type:o,style:r,player:u}));return}p===l.PlayerState.ENDED&&(this.playing=!1,!d&&!this.lightbox&&!y()&&this.reset(),this.$dispatch(T,V({event:"finished",type:o,style:r,player:u})))},10)}}})})},reset(){u&&(u?.stopVideo(),u.destroy(),u=null,this.loaded=!1,this.playing=!1)}}},"@prettyembedAcceptGdpr.window"({detail:c}){c==o&&(this.gdpr="isAccepted")},"@prettyembedPauseInternal.window"({detail:c}){c!=this.$root&&this.pause()}})}function V({player:t,type:e,style:i,event:o}){let s,n=0,r={};try{s=t?.getVideoUrl()||null,n=t?.getCurrentTime()||0,r=t?.getVideoData()||{}}catch{}return{event:o,type:e,style:i,title:r?.title,author:r?.author,videoUrl:s,currentTime:n,videoID:r?.video_id,quality:r?.video_quality,playlistID:r?.list||null}}var K=!1,J=()=>{K||(window.Alpine.plugin([k,H,N,q,W,z]),K=!0)};window.addEventListener("prettyembed:init",J);window.addEventListener("alpine:init",J);})();
